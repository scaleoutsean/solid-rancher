<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <script data-goatcounter="https://ers3x2m6spekxd.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script> <link rel="shortcut icon" href="/solid-rancher/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/solid-rancher/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/solid-rancher/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/solid-rancher/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>Protect Kubernetes Configuration | Solid Rancher</title> <meta name="generator" content="Jekyll v4.1.1" /> <meta property="og:title" content="Protect Kubernetes Configuration" /> <meta name="author" content="scaleoutSean" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Notes on rock-solid K8s clusters with Rancher &amp; NetApp HCI/SolidFire" /> <meta property="og:description" content="Notes on rock-solid K8s clusters with Rancher &amp; NetApp HCI/SolidFire" /> <link rel="canonical" href="https://scaleoutsean.github.io/solid-rancher/protect/protect-k8s-config.html" /> <meta property="og:url" content="https://scaleoutsean.github.io/solid-rancher/protect/protect-k8s-config.html" /> <meta property="og:site_name" content="Solid Rancher" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Protect Kubernetes Configuration" /> <script type="application/ld+json"> {"@type":"WebPage","headline":"Protect Kubernetes Configuration","url":"https://scaleoutsean.github.io/solid-rancher/protect/protect-k8s-config.html","author":{"@type":"Person","name":"scaleoutSean"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://scaleoutsean.github.io/solid-rancher/assets/images/logo.png"},"name":"scaleoutSean"},"description":"Notes on rock-solid K8s clusters with Rancher &amp; NetApp HCI/SolidFire","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="https://scaleoutsean.github.io/solid-rancher/" class="site-title lh-tight"> <div class="site-logo"></div> </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="https://scaleoutsean.github.io/solid-rancher/" class="nav-list-link">Home</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://scaleoutsean.github.io/solid-rancher/plan" class="nav-list-link">Plan</a><ul class="nav-list "><li class="nav-list-item "><a href="https://scaleoutsean.github.io/solid-rancher/plan/network.html" class="nav-list-link">Network</a></li><li class="nav-list-item "><a href="https://scaleoutsean.github.io/solid-rancher/plan/storage.html" class="nav-list-link">Storage</a></li><li class="nav-list-item "><a href="https://scaleoutsean.github.io/solid-rancher/plan/vcenter.html" class="nav-list-link">vCenter and Other Accounts</a></li><li class="nav-list-item "><a href="https://scaleoutsean.github.io/solid-rancher/plan/hcc-vs-ez-rancher.html" class="nav-list-link">HCC or ez-rancher</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://scaleoutsean.github.io/solid-rancher/deploy" class="nav-list-link">Deploy</a><ul class="nav-list "><li class="nav-list-item "><a href="https://scaleoutsean.github.io/solid-rancher/deploy/ez-rancher.html" class="nav-list-link">ez-rancher</a></li><li class="nav-list-item "><a href="https://scaleoutsean.github.io/solid-rancher/deploy/trident.html" class="nav-list-link">NetApp Trident</a></li><li class="nav-list-item "><a href="https://scaleoutsean.github.io/solid-rancher/deploy/infra.html" class="nav-list-link">Other Resources</a></li></ul></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://scaleoutsean.github.io/solid-rancher/protect" class="nav-list-link">Protect</a><ul class="nav-list "><li class="nav-list-item active"><a href="https://scaleoutsean.github.io/solid-rancher/protect/protect-k8s-config.html" class="nav-list-link active">Protect Kubernetes Configuration</a></li><li class="nav-list-item "><a href="https://scaleoutsean.github.io/solid-rancher/protect/protect-solidfire-data.html" class="nav-list-link">Protect Data on SolidFire Storage</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://scaleoutsean.github.io/solid-rancher/automate/" class="nav-list-link">Automate</a><ul class="nav-list "><li class="nav-list-item "><a href="https://scaleoutsean.github.io/solid-rancher/automate/automate-deployment.html" class="nav-list-link">Automate Deployment</a></li><li class="nav-list-item "><a href="https://scaleoutsean.github.io/solid-rancher/automate/automate-operations.html" class="nav-list-link">Automate and Monitor Operations</a></li></ul></li><li class="nav-list-item"><a href="https://scaleoutsean.github.io/solid-rancher/about/" class="nav-list-link">About</a></li></ul> </nav> <footer class="site-footer"> <p>Build: 2021-10-28 16:55+0800</p> </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Solid Rancher" aria-label="Search Solid Rancher" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="https://scaleoutsean.github.io/solid-rancher/protect">Protect</a></li> <li class="breadcrumb-nav-list-item"><span>Protect Kubernetes Configuration</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h3 id="rancher-snapshots-and-backups"> <a href="#rancher-snapshots-and-backups" class="anchor-heading" aria-labelledby="rancher-snapshots-and-backups"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Rancher snapshots and backups </h3> <p>Rancher snapshots are application-level (etcd) snapshots that do not initiate vSphere or SolidFire snapshots. If you configure a Rancher cluster to take local snapshots (default), these will remain stuck in the etcd VMs, so to get to them you either need to be able to get to (one of?) the etcd VMs, or need to take and retain periodic snapshots with vSphere or from SolidFire (with scheduled volume snapshots that snapshot entire Datastore).</p> <p>Read about them <a href="https://rancher.com/docs/rke/latest/en/etcd-snapshots/">here</a>.</p> <h4 id="backup-to-s3"> <a href="#backup-to-s3" class="anchor-heading" aria-labelledby="backup-to-s3"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Backup to S3 </h4> <p>In addition to local snapshots, Rancher snapshots can be shipped off to S3-compatible storage such as NetApp StorageGRID or other.</p> <p>Velero (using Restic for the first test) can backup apps and volume data to StorageGRID S3 storage (see <a href="https://scaleoutsean.github.io/2021/02/02/use-velero-with-netapp-storagegrid.html">here</a>).</p> <h3 id="rancher-vms"> <a href="#rancher-vms" class="anchor-heading" aria-labelledby="rancher-vms"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Rancher VMs </h3> <p>Considering that the provisioning can be fully automated, I am not convinced Rancher VMs need to be backed up.</p> <p>It doesn’t hurt to set a rotating snapshot schedule for SolidFire datastore hosting VMs used for User Clusters, but recovering to an old snapshot may turn out to be useless (I haven’t looked into this yet - I suspect in many falure cases we would need to restore all Master nodes (VMs) at once).</p> <p>If you keep your dynamic K8s data on SolidFire, backup, replicate and snapshot those volumes, but as far as VM that comprise User Clusters are concerned, they should have no unique data because we should be able to reinstate them at will and do it in minutes.</p> <h3 id="container-data"> <a href="#container-data" class="anchor-heading" aria-labelledby="container-data"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Container data </h3> <p>If containers use PVs on SolidFire, please refer to data protection of SolidFire data.</p> <p>Several backup vendors support NetApp Trident CSI, so they may be able to protect volumes on a Trident-based back-end, as well as local (in-VM) PVs.</p> <h3 id="kubernetes-infrastructure-data"> <a href="#kubernetes-infrastructure-data" class="anchor-heading" aria-labelledby="kubernetes-infrastructure-data"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Kubernetes infrastructure data </h3> <p>Depending on how and where it’s stored, we may need to do something about one or more of the following (in no particular order):</p> <ul> <li>Git</li> <li>Security certificates (CA, ICA)</li> <li>Active Directory, MFA/2FA</li> <li>Logs</li> <li>Private registry</li> <li>Network proxy, DNS and switch configuration specific to Rancher</li> </ul> <p>For a cluster, this data should be recoverable from cluster snapshots, but things can get complicated if Management Cluster or Workload Cluster can’t even come up, so we have no way to get to that data. That’s why its best to geographically spread your cluster across physically independent sites - either locally (PROD, DR) or hybrid (On-Premises, Public Cloud).</p> <hr> <footer> <p><a href="#top" id="back-to-top">Back to top</a></p> <div class="d-flex mt-2"> </div> </footer> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
