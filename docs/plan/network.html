<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <script data-goatcounter="https://ers3x2m6spekxd.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script> <link rel="shortcut icon" href="/solid-rancher/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/solid-rancher/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/solid-rancher/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/solid-rancher/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>Network | Solid Rancher</title> <meta name="generator" content="Jekyll v4.1.1" /> <meta property="og:title" content="Network" /> <meta name="author" content="scaleoutSean" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Notes on rock-solid K8s clusters with Rancher &amp; NetApp HCI/SolidFire" /> <meta property="og:description" content="Notes on rock-solid K8s clusters with Rancher &amp; NetApp HCI/SolidFire" /> <link rel="canonical" href="https://scaleoutsean.github.io/solid-rancher/plan/network.html" /> <meta property="og:url" content="https://scaleoutsean.github.io/solid-rancher/plan/network.html" /> <meta property="og:site_name" content="Solid Rancher" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Network" /> <script type="application/ld+json"> {"description":"Notes on rock-solid K8s clusters with Rancher &amp; NetApp HCI/SolidFire","@type":"WebPage","headline":"Network","url":"https://scaleoutsean.github.io/solid-rancher/plan/network.html","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://scaleoutsean.github.io/solid-rancher/assets/images/logo.png"},"name":"scaleoutSean"},"author":{"@type":"Person","name":"scaleoutSean"},"@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="https://scaleoutsean.github.io/solid-rancher/" class="site-title lh-tight"> <div class="site-logo"></div> </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="https://scaleoutsean.github.io/solid-rancher/" class="nav-list-link">Home</a></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://scaleoutsean.github.io/solid-rancher/plan" class="nav-list-link">Plan</a><ul class="nav-list "><li class="nav-list-item active"><a href="https://scaleoutsean.github.io/solid-rancher/plan/network.html" class="nav-list-link active">Network</a></li><li class="nav-list-item "><a href="https://scaleoutsean.github.io/solid-rancher/plan/storage.html" class="nav-list-link">Storage</a></li><li class="nav-list-item "><a href="https://scaleoutsean.github.io/solid-rancher/plan/vcenter.html" class="nav-list-link">vCenter and Other Accounts</a></li><li class="nav-list-item "><a href="https://scaleoutsean.github.io/solid-rancher/plan/hcc-vs-ez-rancher.html" class="nav-list-link">HCC or ez-rancher</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://scaleoutsean.github.io/solid-rancher/deploy" class="nav-list-link">Deploy</a><ul class="nav-list "><li class="nav-list-item "><a href="https://scaleoutsean.github.io/solid-rancher/deploy/ez-rancher.html" class="nav-list-link">ez-rancher</a></li><li class="nav-list-item "><a href="https://scaleoutsean.github.io/solid-rancher/deploy/trident.html" class="nav-list-link">NetApp Trident</a></li><li class="nav-list-item "><a href="https://scaleoutsean.github.io/solid-rancher/deploy/infra.html" class="nav-list-link">Other Resources</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://scaleoutsean.github.io/solid-rancher/protect" class="nav-list-link">Protect</a><ul class="nav-list "><li class="nav-list-item "><a href="https://scaleoutsean.github.io/solid-rancher/protect/protect-k8s-config.html" class="nav-list-link">Protect Kubernetes Configuration</a></li><li class="nav-list-item "><a href="https://scaleoutsean.github.io/solid-rancher/protect/protect-solidfire-data.html" class="nav-list-link">Protect Data on SolidFire Storage</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://scaleoutsean.github.io/solid-rancher/automate/" class="nav-list-link">Automate</a><ul class="nav-list "><li class="nav-list-item "><a href="https://scaleoutsean.github.io/solid-rancher/automate/automate-deployment.html" class="nav-list-link">Automate Deployment</a></li><li class="nav-list-item "><a href="https://scaleoutsean.github.io/solid-rancher/automate/automate-operations.html" class="nav-list-link">Automate and Monitor Operations</a></li></ul></li><li class="nav-list-item"><a href="https://scaleoutsean.github.io/solid-rancher/about/" class="nav-list-link">About</a></li></ul> </nav> <footer class="site-footer"> <p>Build: 2020-12-24 18:07+0800</p> </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Solid Rancher" aria-label="Search Solid Rancher" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="https://scaleoutsean.github.io/solid-rancher/plan">Plan</a></li> <li class="breadcrumb-nav-list-item"><span>Network</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h2 id="ingress"> <a href="#ingress" class="anchor-heading" aria-labelledby="ingress"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Ingress </h2> <p>Do you need to expose your services to the Internet? Or only internally? How is your DNS going to look like? Where do you get TLS certificates and how? How will that impact the security of your applications?</p> <p>You should probably get answers to these (but not only) questions before you start planning the rest. Start with the big picture. Rancher is extremely easy to install so that’s going to be the least of your problems.</p> <p>None of this is NetApp HCI or SolidFire specific, so you may plan without special considerations.</p> <h3 id="external"> <a href="#external" class="anchor-heading" aria-labelledby="external"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> External </h3> <p>Use a network load balancer (software (Docker container or app on a VM, bare metal server) or hardware appliance) external to your Rancher VMs.</p> <p><a href="https://www.nginx.com/products/nginx/">NGINX+</a> is a good choice for enterprise users. There’s a free version, too.</p> <h3 id="internal"> <a href="#internal" class="anchor-heading" aria-labelledby="internal"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Internal </h3> <p>Internal networking is generally easier, but you still need control over internal DNS (over k8s.int.company.com for NLB and *.k8s.int.company.com for services, for example) and the ability to get (or issue) certificates signed by local CA. Self-signed certificates (and auto-created CA) are available but that doesn’t mean you should use them.</p> <p><a href="https://www.varonis.com/blog/active-directory-domain-naming-best-practices/">This post</a> by NetApp’s partner Varonis has good tips about internal domain naming.</p> <h2 id="default-networks-on-netapp-hci"> <a href="#default-networks-on-netapp-hci" class="anchor-heading" aria-labelledby="default-networks-on-netapp-hci"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Default Networks on NetApp HCI </h2> <h3 id="with-vmware-virtual-standard-switch"> <a href="#with-vmware-virtual-standard-switch" class="anchor-heading" aria-labelledby="with-vmware-virtual-standard-switch"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> With VMware Virtual Standard Switch </h3> <p>TODO</p> <h3 id="with-vmware-virtual-distributed-switch"> <a href="#with-vmware-virtual-distributed-switch" class="anchor-heading" aria-labelledby="with-vmware-virtual-distributed-switch"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> With VMware Virtual Distributed Switch </h3> <p>These are created by NDE during deployment and should not be touched:</p> <ul> <li>DVS_HCI_internal_mNode_Network</li> <li>DVS_HCI_internal_Storage_Network</li> <li>DVS_HCI_internal_vCenter_Network</li> <li>DVS_HCI_vMotion</li> <li>DVS_HCI_ISCSI_A</li> <li>DVS_HCI_ISCSI_B</li> </ul> <p>NetApp HCI has <a href="https://docs.netapp.com/us-en/hci-solutions/">solution designs</a> for VMware Private Cloud and other Kubenetes distributions which contain examples of network design for Kubernetes on NetApp HCI.</p> <h2 id="rancher-management-cluster"> <a href="#rancher-management-cluster" class="anchor-heading" aria-labelledby="rancher-management-cluster"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Rancher Management Cluster </h2> <p>This cluster must be able to communicate with at least the first three destinations in the list below:</p> <ul> <li>vCenter of the VMware cluster in which it is installed</li> <li>NetApp HCI Management Node (HCC services)</li> <li>All Rancher Workload Clusters it manages (each may have a separate Management VLAN, but they could also share a common Kubernetes Cluster Management VLAN)</li> <li>NetApp HCI Storage Management IP (i.e. SolidFire MVIP, if NetApp Trident is used for storage provisioning) <ul> <li>Also any other storage Management IP involved (ONTAP SVM Management IP, external NAS, etc.)</li> </ul> </li> <li>It may also need to be able to connect to a backup network, another cluster at the DR site, a gateway to connect to your Public Cloud provider, and so on</li> </ul> <h2 id="rancher-user-clusters"> <a href="#rancher-user-clusters" class="anchor-heading" aria-labelledby="rancher-user-clusters"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Rancher User Cluster(s) </h2> <p>These need to be able to communicate with:</p> <ul> <li>The Rancher Management Cluster that manages it</li> <li>Storage Network (Worker Nodes only, and only if these use iSCSI or NFS storage provisioned by NetApp Trident) <ul> <li>NFS could be ONTAP Select running on VMware or any ONTAP appliance reachable from Worker NodesA)</li> <li>iSCSI could be NetApp HCI storage, NetApp E-Series (iSCSI), ONTAP (iSCSI)</li> </ul> </li> </ul> <p>Optionally these also may need to connect to other networks (for example to another cluster or service in a branch office or public cloud.)</p> <h2 id="dns-ntp-and-other-critical-network-services"> <a href="#dns-ntp-and-other-critical-network-services" class="anchor-heading" aria-labelledby="dns-ntp-and-other-critical-network-services"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> DNS, NTP and other critical network services </h2> <p>As usual: make sure vSphere, HCC/mNode and Rancher requirements are satisfied.</p> <p>If your services can’t work without Active Directory or outgoing Internet connectivity, take that into consideration as well.</p> <h2 id="kubernetes-networking-options-with-rancher"> <a href="#kubernetes-networking-options-with-rancher" class="anchor-heading" aria-labelledby="kubernetes-networking-options-with-rancher"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Kubernetes Networking Options with Rancher </h2> <ul> <li>Flannel</li> <li>Calico</li> <li>Canal (Network Isolation option) - default</li> <li>Weave</li> </ul> <p>Network isolation may be preferred for K8s Projects exposed to the Internet.</p> <p>The last three offer the option of modifying the MTU (CNI Plugin MTU Override). If your vSphere workload networks use MTU 9000, you can look into whether using non-default values helps (in terms of preformance, or avoid packet fragmentation, for example).</p> <p>NetApp HCI enforces MTU 9000 on iSCSI networks while other networks can use MTU 1500. Rancher Worker VMs may use MTU 9000 on the networks for iSCSI, but they can also work with iSCSI interfaces set to VM defaults (MTU 1500, for example). Other interfaces may not be able to use jumbo frames if vSphere networking does not support them.</p> <p>RancherOS could set MTU 9000 in cloud-init.yaml like so:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">rancher</span><span class="pi">:</span>
  <span class="na">docker</span><span class="pi">:</span>
    <span class="na">extra_args</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">--mtu</span><span class="pi">,</span> <span class="nv">9000</span><span class="pi">]</span>
</code></pre></div></div> <hr> <footer> <p><a href="#top" id="back-to-top">Back to top</a></p> <div class="d-flex mt-2"> </div> </footer> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
