<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <script data-goatcounter="https://ers3x2m6spekxd.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script> <link rel="shortcut icon" href="/solid-rancher/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/solid-rancher/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/solid-rancher/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/solid-rancher/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>Protect | Solid Rancher</title> <meta name="generator" content="Jekyll v4.1.1" /> <meta property="og:title" content="Protect" /> <meta name="author" content="scaleoutSean" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Notes on rock-solid K8s clusters with Rancher &amp; NetApp HCI/SolidFire" /> <meta property="og:description" content="Notes on rock-solid K8s clusters with Rancher &amp; NetApp HCI/SolidFire" /> <link rel="canonical" href="https://scaleoutsean.github.io/solid-rancher/protect" /> <meta property="og:url" content="https://scaleoutsean.github.io/solid-rancher/protect" /> <meta property="og:site_name" content="Solid Rancher" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Protect" /> <script type="application/ld+json"> {"@type":"WebPage","headline":"Protect","url":"https://scaleoutsean.github.io/solid-rancher/protect","author":{"@type":"Person","name":"scaleoutSean"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://scaleoutsean.github.io/solid-rancher/assets/images/logo.png"},"name":"scaleoutSean"},"description":"Notes on rock-solid K8s clusters with Rancher &amp; NetApp HCI/SolidFire","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="https://scaleoutsean.github.io/solid-rancher/" class="site-title lh-tight"> <div class="site-logo"></div> </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="https://scaleoutsean.github.io/solid-rancher/" class="nav-list-link">Home</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://scaleoutsean.github.io/solid-rancher/plan" class="nav-list-link">Plan</a><ul class="nav-list "><li class="nav-list-item "><a href="https://scaleoutsean.github.io/solid-rancher/plan/network.html" class="nav-list-link">Network</a></li><li class="nav-list-item "><a href="https://scaleoutsean.github.io/solid-rancher/plan/storage.html" class="nav-list-link">Storage</a></li><li class="nav-list-item "><a href="https://scaleoutsean.github.io/solid-rancher/plan/vcenter.html" class="nav-list-link">vCenter and Other Accounts</a></li><li class="nav-list-item "><a href="https://scaleoutsean.github.io/solid-rancher/plan/hcc-vs-ez-rancher.html" class="nav-list-link">HCC or ez-rancher</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://scaleoutsean.github.io/solid-rancher/deploy" class="nav-list-link">Deploy</a><ul class="nav-list "><li class="nav-list-item "><a href="https://scaleoutsean.github.io/solid-rancher/deploy/ez-rancher.html" class="nav-list-link">ez-rancher</a></li><li class="nav-list-item "><a href="https://scaleoutsean.github.io/solid-rancher/deploy/trident.html" class="nav-list-link">NetApp Trident</a></li><li class="nav-list-item "><a href="https://scaleoutsean.github.io/solid-rancher/deploy/infra.html" class="nav-list-link">Other Resources</a></li></ul></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://scaleoutsean.github.io/solid-rancher/protect" class="nav-list-link active">Protect</a><ul class="nav-list "><li class="nav-list-item "><a href="https://scaleoutsean.github.io/solid-rancher/protect/protect-k8s-config.html" class="nav-list-link">Protect Kubernetes Configuration</a></li><li class="nav-list-item "><a href="https://scaleoutsean.github.io/solid-rancher/protect/protect-solidfire-data.html" class="nav-list-link">Protect Data on SolidFire Storage</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://scaleoutsean.github.io/solid-rancher/automate/" class="nav-list-link">Automate</a><ul class="nav-list "><li class="nav-list-item "><a href="https://scaleoutsean.github.io/solid-rancher/automate/automate-deployment.html" class="nav-list-link">Automate Deployment</a></li><li class="nav-list-item "><a href="https://scaleoutsean.github.io/solid-rancher/automate/automate-operations.html" class="nav-list-link">Automate and Monitor Operations</a></li></ul></li><li class="nav-list-item"><a href="https://scaleoutsean.github.io/solid-rancher/about/" class="nav-list-link">About</a></li></ul> </nav> <footer class="site-footer"> <p>Build: 2021-10-28 16:55+0800</p> </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Solid Rancher" aria-label="Search Solid Rancher" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <div id="main-content" class="main-content" role="main"> <h3 id="disaster-recovery"> <a href="#disaster-recovery" class="anchor-heading" aria-labelledby="disaster-recovery"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Disaster Recovery </h3> <p>You can use SolidFire native replication (see Awesome SolidFire) to replicate Datastores and Volumes used by Rancher to a remote site. Both local and remote volumes can take scheduled and on-demand snapshots.</p> <p>Rancher clusters can be scheduled to take scheduled and on-demand snapshots to local disk or S3 bucket. These snapshots protect data from etcd and can be used to restore etcd, Kubernetes version, and cluster configuration. Cluster must exist and be able to run a snapshot restore procedure.</p> <h3 id="business-continuity-for-storage"> <a href="#business-continuity-for-storage" class="anchor-heading" aria-labelledby="business-continuity-for-storage"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Business Continuity for Storage </h3> <p>Assuming we stretch a Kubernetes cluster across two independent sites, each with its own SolidFire or NetApp HCI storage cluster, we don’t need to deal with Kubernetes, VMware or NetApp HCI storage (SolidFire) replication and failover (BC through Kubernetes, below)</p> <p>If Rancher Kubernetes runs on one site and we want to fail it over to another site with same network configuration, we can take advantage of SolidFire SRA and VMware SRM to replicate VMs and Trident PVs to the other site, and fail over when required.</p> <p>VMware SRM can fail-over to another site and bring up Rancher VMs, but we still need to expose Trident volumes to VMs (Rancher worker nodes). To do that we’d stop SolidFire replication for PVs and make it possible to access those volumes in a read-write fashion.</p> <h4 id="trident-csi-volume-import-feature"> <a href="#trident-csi-volume-import-feature" class="anchor-heading" aria-labelledby="trident-csi-volume-import-feature"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Trident CSI Volume Import Feature </h4> <p>Since Trident started to support Volume Import feature, it is possible - and in fact recommended - to import SolidFire replica volumes, rather than use search-and-replace of volume IQN strings.</p> <p><a href="https://youtu.be/aSFxlGoHgdA">This video</a> shows how Kubernetes can failover to another SolidFire cluster in seconds. There’s a very detailed post about it <a href="https://scaleoutsean.github.io/2021/03/20/kubernetes-solidfire-failover-failback.html">here</a>.</p> <h4 id="pre-csi-trident-search-and-replace-for-trident-volumes"> <a href="#pre-csi-trident-search-and-replace-for-trident-volumes" class="anchor-heading" aria-labelledby="pre-csi-trident-search-and-replace-for-trident-volumes"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Pre-CSI Trident: Search-and-Replace for Trident Volumes </h4> <p>Storage-dependent procedure:</p> <ul> <li>Run a Search-and-Replace operation for Trident targets (paths) on PROD vs. DR site (this replaces Cluster UUID string from PROD with Cluster UUID from DR site and loads updated iSCSI target information)</li> <li>Stop-Reverse-Start (replication) sequence for storage replication (this stops PROD-&gt;DR replication, makes DR volumes Read-Write, and PROD volumes (if still reachable) Read-Only, and kicks off DR-&gt;PROD replication)</li> </ul> <p>These aren’t currently documented specifically for the Rancher on HCI solution or even in the NetApp Trident documentation, but use SolidFire, Kuberetes and Trident features and therefore do not directly depend on Rancher itself. In theory we could use vSphere SRM and SolidFire SRA to failover VMs running Rancher, but that would be a complicated approach and I doubt we’ll see it officially recommended.</p> <p>Awesome SolidFire has examples of how Target IQNs differ between clusters. YouTube has a demo of how PowerShell can be used to pair clusters, create replication relationship between two SolidFire storage clusters. It takes 30 seconds. YouTube also has a (longish, 15 min) video with a demonstration of SolidFire storage cluster failover and failback in a K8s/Trident environment.</p> <h4 id="bc-through-kubernetes"> <a href="#bc-through-kubernetes" class="anchor-heading" aria-labelledby="bc-through-kubernetes"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> BC through Kubernetes </h4> <p>As mentioned earlier, if services running on Kubernetes are designed and protected in a storage- and VMware-independent fashion, BC can be obtained independently of SolidFire and VMware.</p> <p>Example: a Web site backed by a NOSQL cluster with Web and Database containers spread across multiple sites running indepdently NetApp HCI or SolidFire clusters.</p> <p>This is a recommended approach because it features separation of concerns between infrastructure and services.</p> <h3 id="backup-and-restore-of-kubernetes-clusters-settings-applications-and-data-pvs"> <a href="#backup-and-restore-of-kubernetes-clusters-settings-applications-and-data-pvs" class="anchor-heading" aria-labelledby="backup-and-restore-of-kubernetes-clusters-settings-applications-and-data-pvs"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Backup and Restore of Kubernetes clusters, settings, applications and data (PVs) </h3> <h4 id="backup-of-clusters-and-cluster-settings"> <a href="#backup-of-clusters-and-cluster-settings" class="anchor-heading" aria-labelledby="backup-of-clusters-and-cluster-settings"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Backup of clusters and cluster settings </h4> <p>Rancher provides its own “snapshot” feature that can backup cluster configuration to a local disk or S3 storage such as NetApp StorageGRID or Public Cloud Object Storage. For cluster configuration I would prefer that over VMware or SolidFire snapshots or backups.</p> <h4 id="backup-of-persistent-volumes-pvs-and-applications"> <a href="#backup-of-persistent-volumes-pvs-and-applications" class="anchor-heading" aria-labelledby="backup-of-persistent-volumes-pvs-and-applications"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Backup of Persistent Volumes (PVs) and applications </h4> <p>For cluster data, you could use application backups or a 3rd party backup software that can backup K8s containers (see Awesome SolidFire). Some - such as Kasten - integrate with CSI and also Kuberntes API to provide data and application recovery (see this <a href="https://scaleoutsean.github.io/2020/12/21/kasten-rancher-netapp-hci-solidfire-k8s-backup.html">post</a> to get started).</p> <p>Applications (Namespaces, Projects, Labels, etc.) should presumably be backed up with scheduled Rancher cluster snapshots, but if you want to take those in sync with PVs, then you either have two places to manage (one in Rancher snapshot settings, another in either SolidFire snapshot schedules, or backup application (Commvault BR, Kasten K10). For complex environments it makes sense to unify these workflows and manage them from a commercially supported application.</p> <hr> <h2 class="text-delta">Table of contents</h2> <ul> <li> <a href="https://scaleoutsean.github.io/solid-rancher/protect/protect-k8s-config.html">Protect Kubernetes Configuration</a> </li> <li> <a href="https://scaleoutsean.github.io/solid-rancher/protect/protect-solidfire-data.html">Protect Data on SolidFire Storage</a> </li> </ul> <hr> <footer> <p><a href="#top" id="back-to-top">Back to top</a></p> <div class="d-flex mt-2"> </div> </footer> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
