<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <script data-goatcounter="https://ers3x2m6spekxd.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script> <link rel="shortcut icon" href="/solid-rancher/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/solid-rancher/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/solid-rancher/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/solid-rancher/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>Automate and Monitor Operations | Solid Rancher</title> <meta name="generator" content="Jekyll v4.1.1" /> <meta property="og:title" content="Automate and Monitor Operations" /> <meta name="author" content="scaleoutSean" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Notes on rock-solid K8s clusters with Rancher &amp; NetApp HCI/SolidFire" /> <meta property="og:description" content="Notes on rock-solid K8s clusters with Rancher &amp; NetApp HCI/SolidFire" /> <link rel="canonical" href="https://scaleoutsean.github.io/solid-rancher/automate/automate-operations.html" /> <meta property="og:url" content="https://scaleoutsean.github.io/solid-rancher/automate/automate-operations.html" /> <meta property="og:site_name" content="Solid Rancher" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Automate and Monitor Operations" /> <script type="application/ld+json"> {"description":"Notes on rock-solid K8s clusters with Rancher &amp; NetApp HCI/SolidFire","@type":"WebPage","headline":"Automate and Monitor Operations","url":"https://scaleoutsean.github.io/solid-rancher/automate/automate-operations.html","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://scaleoutsean.github.io/solid-rancher/assets/images/logo.png"},"name":"scaleoutSean"},"author":{"@type":"Person","name":"scaleoutSean"},"@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="https://scaleoutsean.github.io/solid-rancher/" class="site-title lh-tight"> <div class="site-logo"></div> </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="https://scaleoutsean.github.io/solid-rancher/" class="nav-list-link">Home</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://scaleoutsean.github.io/solid-rancher/plan" class="nav-list-link">Plan</a><ul class="nav-list "><li class="nav-list-item "><a href="https://scaleoutsean.github.io/solid-rancher/plan/network.html" class="nav-list-link">Network</a></li><li class="nav-list-item "><a href="https://scaleoutsean.github.io/solid-rancher/plan/storage.html" class="nav-list-link">Storage</a></li><li class="nav-list-item "><a href="https://scaleoutsean.github.io/solid-rancher/plan/vcenter.html" class="nav-list-link">vCenter and Other Accounts</a></li><li class="nav-list-item "><a href="https://scaleoutsean.github.io/solid-rancher/plan/hcc-vs-ez-rancher.html" class="nav-list-link">HCC or ez-rancher</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://scaleoutsean.github.io/solid-rancher/deploy" class="nav-list-link">Deploy</a><ul class="nav-list "><li class="nav-list-item "><a href="https://scaleoutsean.github.io/solid-rancher/deploy/ez-rancher.html" class="nav-list-link">ez-rancher</a></li><li class="nav-list-item "><a href="https://scaleoutsean.github.io/solid-rancher/deploy/trident.html" class="nav-list-link">NetApp Trident</a></li><li class="nav-list-item "><a href="https://scaleoutsean.github.io/solid-rancher/deploy/infra.html" class="nav-list-link">Other Resources</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://scaleoutsean.github.io/solid-rancher/protect" class="nav-list-link">Protect</a><ul class="nav-list "><li class="nav-list-item "><a href="https://scaleoutsean.github.io/solid-rancher/protect/protect-k8s-config.html" class="nav-list-link">Protect Kubernetes Configuration</a></li><li class="nav-list-item "><a href="https://scaleoutsean.github.io/solid-rancher/protect/protect-solidfire-data.html" class="nav-list-link">Protect Data on SolidFire Storage</a></li></ul></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://scaleoutsean.github.io/solid-rancher/automate/" class="nav-list-link">Automate</a><ul class="nav-list "><li class="nav-list-item "><a href="https://scaleoutsean.github.io/solid-rancher/automate/automate-deployment.html" class="nav-list-link">Automate Deployment</a></li><li class="nav-list-item active"><a href="https://scaleoutsean.github.io/solid-rancher/automate/automate-operations.html" class="nav-list-link active">Automate and Monitor Operations</a></li></ul></li><li class="nav-list-item"><a href="https://scaleoutsean.github.io/solid-rancher/about/" class="nav-list-link">About</a></li></ul> </nav> <footer class="site-footer"> <p>Build: 2021-01-29 15:57+0800</p> </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Solid Rancher" aria-label="Search Solid Rancher" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="https://scaleoutsean.github.io/solid-rancher/automate/">Automate</a></li> <li class="breadcrumb-nav-list-item"><span>Automate and Monitor Operations</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <p>Here are some operational and monitoring tips for NetApp HCI and SolidFire</p> <h3 id="operations"> <a href="#operations" class="anchor-heading" aria-labelledby="operations"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Operations </h3> <p>Popular choices to automate operations in a NetApp HCI, SolidFire or eSDS environment:</p> <ul> <li>HashiCorp Terraform (vSphere, Rancher and SolidFire)</li> <li>Red Hat Ansible (vSphere, SolidFire, Rancher)</li> <li>VMware PowerCLI, pyvmomi, vRealize Automation, vRealize Operations</li> <li>Storage-specific operations: <ul> <li>vCenter storage operations can be done through the Element Plug-in for vCenter (no public API), Ansible, Terraform, SolidFire Tools for PowerShell, SolidFire Python CLI as well as several SDKs (Python, .NET, etc.) - find examples in the Awesome SolidFire repository</li> <li>NetApp Trident provides the ability to snapshot and import (which also makes it easy to work with clones) SolidFire volumes</li> </ul> </li> <li>Rancher-specific operations: <ul> <li>Please refer to the Rancher documentation for these details (we want to avoid unnecessary duplication or rehashing of that content)</li> </ul> </li> </ul> <h4 id="updates"> <a href="#updates" class="anchor-heading" aria-labelledby="updates"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Updates </h4> <ul> <li>NetApp HCI, SolidFire and eSDS are updated from NetApp HCC <ul> <li>NetApp HCI: HCC updates SolidFire firmware and software and firmware of NetApp HCI compute nodes. Vmware software is updated by using standard VMware procedures. Element Plug-in for vCenter (also known as VCP or vCenter Plug-in) must be removed before vCenter upgrade and deployed after, using HCC). See the NetApp IMT site for the information about supported software versions.</li> <li>NetApp SolidFire: HCC updates SolidFire firmware and software. The note on VCP on NetApp HCI also applies here.</li> <li>On eSDS, HCC updates SolidFire software. The node on VCP on NetApp HCI also applies here. eSDS runs on Docker so server firmware are updated by the server vendor.</li> </ul> </li> <li>Rancher <ul> <li>Please check NetApp HCC documentation and KB articles</li> <li>In general, the idea is to not deviate from a Rancher-supported approach unless there are NetApp HCI-specific guidelines</li> </ul> </li> <li>NetApp Trident <ul> <li>Follow the HCC or (if you deploy Trident using Trident documentation) Trident upgrade documentation and compatibility information</li> </ul> </li> </ul> <h4 id="adding-and-removing-a-user-cluster"> <a href="#adding-and-removing-a-user-cluster" class="anchor-heading" aria-labelledby="adding-and-removing-a-user-cluster"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Adding and Removing a User Cluster </h4> <p>These are not set in stone but rather a list of possible actions when adding and removing a Rancher User (Workload) Cluster.</p> <ul> <li>Add <ul> <li>Infrastructure: create User Cluster-specific resources (external DNS, certificates, firewall rules, app gateway paths, AD/LDAP resources, etc.)</li> <li>VMware: create User Cluster-specific network settings</li> <li>SolidFire: create a new storage account for NetApp Trident on individual User Cluster. Optionally you could also clone (and later import with Trident Import) one or more SolidFire volumes for the new cluster to use (for example, volume with pre-configured Private Docker Registry containing the same 10 ISOs that all other clusters use) - this could be useful to avoid the unnecessary copying of data into the new cluster and - if you keep these consistent, you’ll get 10x efficiency on 10 copies in 10 User clusters</li> <li>Rancher: deploy User Cluster, in User Cluster deploy Trident, create Storage Classes</li> <li>Infrastructure: configure log forwarding, event and performance, montoring, backup, replication</li> </ul> </li> <li>Remove <ul> <li>Rancher: remove User Cluster from Management Cluster</li> <li>SolidFire: remove Trident account for User Cluster</li> <li>VMware: remove User Cluster-specific networks</li> <li>Infrastructure: undo User Cluster-specific DNS and external configuration (firewall rules, DNS entries, TLS certificates, Active Directory users or groups, etc.)</li> </ul> </li> </ul> <h3 id="monitoring-and-auditing"> <a href="#monitoring-and-auditing" class="anchor-heading" aria-labelledby="monitoring-and-auditing"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Monitoring and Auditing </h3> <ul> <li>Officially-recommmended tools and apps: NetApp ActiveIQ (gratis), NetApp Cloud Insights (public cloud-based control plane with on-prem data acquisition; gratis and paid versions are available)</li> <li>NetApp HCI and SolidFire-related <ul> <li>NetApp Trident gathers basic metrics for SolidFire back-ends and sends them to Kubernetes</li> <li><a href="https://github.com/scaleoutsean/hcicollector">HCI Collector</a> - sfcollector, written in Python, gathers a bunch of SolidFire performance metrics and sends them to Graphite to be visualized with Grafana. HCI Collector can gather server (that is, H-Series compute node) events via SNMP and IPMI</li> </ul> </li> <li>For other tools and log forwarding, including NetApp HCC (Hybrid Cloud Control) please see Awesome SolidFire, there’s a ton of stuff in there (Splunk, ELK, Graylog, Nagios…)</li> </ul> <h4 id="storage-capacity-and-performance-monitoring"> <a href="#storage-capacity-and-performance-monitoring" class="anchor-heading" aria-labelledby="storage-capacity-and-performance-monitoring"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Storage Capacity and Performance Monitoring </h4> <p>Environments with multiple user clusters (and likely mutiple storage accounts for Trident) can easily monitor capacity and performance by (Trident) storage account.</p> <p>Alerts can be set to warn when an account us using more than certain amount of capacity or Min IOPS (or other IOPS). HCI Collector, for example, makes it easy to create such dashboards from data gathered by default. You can also use it to plot capacity consumption trends. Of course there is also ActiveIQ and Cloud Insights and more (check Awesome SolidFire).</p> <p>Since January 2021 NetApp Cloud Insights Standard Edition (unfortunately it’s not the free one) can provide alerting via webhooks as well, enabling users to send alerts to Slack and other destinations.</p> <hr> <footer> <p><a href="#top" id="back-to-top">Back to top</a></p> <div class="d-flex mt-2"> </div> </footer> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
